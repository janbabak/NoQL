# NoQL Frontend

![Frontend Badge](https://img.shields.io/badge/React-TypeScript-blue)
[![React](https://img.shields.io/badge/React-61DAFB.svg?style=flat&logo=React&logoColor=black)](https://react.dev)

---

## ğŸš€ Overview

**NoQL Frontend** is a thin client written in **React.js** with **TypeScript**.  
It interacts with the backend service to display query results and visualizations generated by the Plot Service.

**Key highlights:**
- React + TypeScript for type safety and maintainability
- Vite-powered development and build system
- Redux Toolkit for state management
- Dockerized for consistent environment across dev, staging, and production
- Runtime environment variable injection for flexible deployment

---

## ğŸ—‚ï¸ Table of Contents

- [Description](#-description)
- [Tech Stack](#-tech-stack)
- [Project Structure](#-project-structure)
- [Software Requirements](#-software-requirements)
- [How to Run](#-how-to-run)
- [Other Useful Commands](#other-useful-commands)
- [Environment Variables](#environment-variables)
- [Frontend Docker Image](#frontend-docker-image)

---

## ğŸ“ Description

NoQL frontend client is a **thin, interactive client** written in **React.js** with **TypeScript**, designed to:

- Display structured query results
- Render plots generated by the backend Plot Service
- Provide a responsive, modern UI with reusable components

---

## ğŸ”¨ Tech Stack

- [React](https://react.dev)
- [Redux](https://redux.js.org)
- [TypeScript](https://www.typescriptlang.org)
- [Vite](https://vite.dev)
- [Material UI](https://mui.com)
- [Nginx](https://nginx.org)


---

## ğŸŒ² Project Structure

```text
frontend/
â”œâ”€ NoQL/                                  # Frontend app root
â”‚  â”œâ”€ public/                             # Public/static files (favicon, index.html)
â”‚  â”œâ”€ src/                                # Source code
â”‚  â”‚  â”œâ”€ assets/                          # Images, fonts, and other static assets
â”‚  â”‚  â”œâ”€ components/                      # Reusable UI components
â”‚  â”‚  â”œâ”€ pages/                           # Application pages
â”‚  â”‚  â”œâ”€ routes/                          # React router setup
â”‚  â”‚  â”œâ”€ services/                        # API clients, logging, utilities
â”‚  â”‚  â”œâ”€ state/                           # Redux Toolkit state management
â”‚  â”‚  â”œâ”€ types/                           # TypeScript types and interfaces
â”‚  â”œâ”€ .env                                # Local development environment variables
â”‚  â”œâ”€ frontend.Dockerfile                  # Dockerfile for frontend container
â”‚  â”œâ”€ nginx.conf                           # Nginx configuration
â”‚  â””â”€ README.md                            # Documentation
```

---

## âœ… Software Requirements

The following software must be installed for development, building, and deployment.

- **Frontend**
    - Node.js 18+
    - Vite (installed via `npm install` as devDependency)
    - Docker
    - Docker Compose

- **Deployment**
    - AWS CLI
    - Make

---

## ğŸƒ How to Run

- **Run natively**
    - Install dependencies
      ```shell
      npm install
      ```
    - Run frontend
      ```shell
      npm run dev
      ```

- **Run locally with Docker Compose**
    - Instructions: [`../../infra/local-stack/README.md`](../../infra/local-stack/README.md)

---

## Other useful commands

- **Build**
  ```shell
  npm run build
  ```
- **Build for production environment**
  ```shell
  npm run build:prod
  ```
- **Execute lint**
    ```shell
    npm run lint
    ```

---

## Environment Variables

This frontend supports **both build-time (Vite)** and **runtime (Docker)** environment variables.  
The same Docker image can be reused across environments by injecting variables at container startup.

### Supported Variables

| Variable             | Description                         |
|----------------------|-------------------------------------|
| `BACKEND_URL`        | Base URL of the backend server      |
| `API_TIMEOUT_MILLIS` | API request timeout in milliseconds |

### Variable Format

#### Development (Vite)

For local development, environment variables **must use the `VITE_` prefix** so that Vite can expose them to the
application:

```env
VITE_BACKEND_URL=http://localhost:8080
VITE_API_TIMEOUT_MILLIS=40000
```

#### Docker / Runtime

When running the application inside a Docker container, environment variables **must NOT use the `VITE_` prefix**:

```env
BACKEND_URL=http://localhost:8080
API_TIMEOUT_MILLIS=40000
```

These variables are injected dynamically at container startup.

### Adding or Modifying Environment Variables

When introducing a new environment variable, the following files **must be updated**:

- `frontend/NoQL/env.template.js`
- `frontend/NoQL/src/env.ts`
- `frontend/NoQL/src/global.d.ts`
- `frontend/NoQL/.env` (for local development)

### How the Environment Injection Works

Environment variables are **resolved at runtime**, not baked into the build output.

#### `frontend/NoQL/env.template.js`

- Acts as a **template** for runtime configuration.
- Contains placeholders (e.g. `${BACKEND_URL}`) instead of real values.
- Is copied into the Docker image unchanged.
- During container startup, placeholders are replaced using:
  ```sh
  envsubst < /usr/share/nginx/html/env.template.js > /usr/share/nginx/html/env.js
  ```
- The generated `env.js` contains the final runtime configuration consumed by the frontend.

---

#### `frontend/NoQL/src/env.ts`

- Provides a **typed, centralized access point** for environment variables.
- Reads runtime variables from `window._env_` (generated by `env.js`).
- Falls back to Vite build-time variables (`import.meta.env.VITE_*`) when runtime variables are not available (e.g.
  local development).
- Exports a single `ENV` object that should be used throughout the application.

---

#### `frontend/NoQL/src/global.d.ts`

- Extends the global `Window` interface with the `_env_` property.
- Ensures TypeScript is aware of runtime-injected variables.
- Prevents type errors when accessing `window._env_`.

---

#### `frontend/NoQL/.env`

- Provides environment variables for **local development only**.
- Variables must use the `VITE_` prefix to be picked up by Vite.

---

## Frontend Docker Image

### Build Frontend Image

Builds the frontend Docker image locally.  
The image version is read from the `version` field in `package.json`.

```bash
npm run dockerBuildFrontend
```

### Build and Push Frontend Image

Build and push can be executed by triggering a manual [GitHub action](https://github.com/janbabak/NoQL/actions/workflows/frontend.yaml).

Builds and pushes the frontend Docker image to the [Docker Hub](https://hub.docker.com/r/janbabak/noql-frontend) registry.  
The image version is read from the `version` field in `package.json`.

```bash
npm run dockerPushFrontend
```

### Run Frontend Container

- Expose container port `80` to a desired host port
- Provide required environment variables via an .env file

```bash
docker run -p 80:80 \
  --env-file ./frontend/NoQL/.env \
  --name noql-frontend \
  janbabak/noql-frontend:0.0.1
```