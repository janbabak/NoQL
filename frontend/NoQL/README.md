# NoQL Frontend

## ğŸ—‚ï¸ Table of Contents

- [Description](#-description)
- [Project Structure](#-project-structure)
- [Software Requirements](#-software-requirements)
- [How to Run](#-how-to-run)
- [Environment Variables](#-environment-variables)

---

## ğŸ“ Description

NoQL frontend client is a thin client written in React.js framework with TypeScript.

---

## ğŸŒ² Project Structure

```text
frontend/                                 ... frontend app root
â”œâ”€ NoQL/                 
â”‚  â”œâ”€ public/                             ... public files
â”‚  â”œâ”€ src/                                ... source code
â”‚  â”‚  â”œâ”€ assets/                          ... static assets such as images
â”‚  â”‚  â”œâ”€ components/                      ... reusable components
â”‚  â”‚  â”œâ”€ pages/                           ... pages
â”‚  â”‚  â”œâ”€ routes/                          ... routing
â”‚  â”‚  â”œâ”€ services/                        ... services (api, logging,...)
â”‚  â”‚  â”œâ”€ state/                           ... state management (Redux Toolkit)
â”‚  â”‚  â”œâ”€ types/                           ... types
|  | .env                                 ... environment variables for local development
|  | frontend.Dockerfile                  ... front end docker image
|  | nginx.conf                           ... Nginx configuration
|  | README.md                            ... documentation
```

---

## âœ… Software Requirements

The following software must be installed for development, building, and deployment.

- **Frontend**
    - Node.js 18+
    - Vite (installed via `npm install` as devDependency)
    - Docker
    - Docker Compose

- **Deployment**
    - AWS CLI
    - Make

---

## ğŸƒ How to Run

- **Run natively**
    - Install dependencies
      ```shell
      npm install
      ```
    - Run frontend
      ```shell
      npm run dev
      ```

- **Run locally with Docker Compose**
    - Instructions: [`../../infra/local-stack/README.md`](../../infra/local-stack/README.md)

---

## Other useful commands

- **Build**
  ```shell
  npm run build
  ```
- **Build for production environment**
  ```shell
  npm run build:prod
  ```
- **Execute lint**
    ```shell
    npm run lint
    ```

---

## Environment Variables

This frontend supports **both build-time (Vite)** and **runtime (Docker)** environment variables.  
The same Docker image can be reused across environments by injecting variables at container startup.

### Supported Variables

| Variable             | Description                         |
|----------------------|-------------------------------------|
| `BACKEND_URL`        | Base URL of the backend server      |
| `API_TIMEOUT_MILLIS` | API request timeout in milliseconds |

### Variable Format

#### Development (Vite)

For local development, environment variables **must use the `VITE_` prefix** so that Vite can expose them to the
application:

```env
VITE_BACKEND_URL=http://localhost:8080
VITE_API_TIMEOUT_MILLIS=40000
```

#### Docker / Runtime

When running the application inside a Docker container, environment variables **must NOT use the `VITE_` prefix**:

```env
BACKEND_URL=http://localhost:8080
API_TIMEOUT_MILLIS=40000
```

These variables are injected dynamically at container startup.

### Adding or Modifying Environment Variables

When introducing a new environment variable, the following files **must be updated**:

- `frontend/NoQL/env.template.js`
- `frontend/NoQL/src/env.ts`
- `frontend/NoQL/src/global.d.ts`
- `frontend/NoQL/.env` (for local development)

### How the Environment Injection Works

Environment variables are **resolved at runtime**, not baked into the build output.

#### `frontend/NoQL/env.template.js`

- Acts as a **template** for runtime configuration.
- Contains placeholders (e.g. `${BACKEND_URL}`) instead of real values.
- Is copied into the Docker image unchanged.
- During container startup, placeholders are replaced using:
  ```sh
  envsubst < /usr/share/nginx/html/env.template.js > /usr/share/nginx/html/env.js
  ```
- The generated `env.js` contains the final runtime configuration consumed by the frontend.

---

#### `frontend/NoQL/src/env.ts`

- Provides a **typed, centralized access point** for environment variables.
- Reads runtime variables from `window._env_` (generated by `env.js`).
- Falls back to Vite build-time variables (`import.meta.env.VITE_*`) when runtime variables are not available (e.g.
  local development).
- Exports a single `ENV` object that should be used throughout the application.

---

#### `frontend/NoQL/src/global.d.ts`

- Extends the global `Window` interface with the `_env_` property.
- Ensures TypeScript is aware of runtime-injected variables.
- Prevents type errors when accessing `window._env_`.

---

#### `frontend/NoQL/.env`

- Provides environment variables for **local development only**.
- Variables must use the `VITE_` prefix to be picked up by Vite.

---

## Frontend Docker Image

### Build Frontend Image

Builds the frontend Docker image locally.  
The image version is read from the `version` field in `package.json`.

```bash
npm run dockerBuildFrontend
```

### Build and Push Frontend Image

Build and push can be executed by triggering a manual GitHub action.

Builds and pushes the frontend Docker image to the registry.  
The image version is read from the `version` field in `package.json`.

```bash
npm run dockerPushFrontend
```

### Run Frontend Container

- Expose container port `80` to a desired host port
- Provide required environment variables via an env file

```bash
docker run -p 80:80 \
  --env-file ./frontend/NoQL/.env \
  --name noql-frontend \
  janbabak/noql-frontend:0.0.1
```